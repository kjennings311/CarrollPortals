@{
    ViewBag.Title = "Employee Lease Rider";
}

<input type="hidden" id="pageid" value="empleaserider" />

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <ol class="breadcrumb" style="padding: 8px 15px;">
            <li>
                <a href="~/Home/Index">Home</a>
            </li>

            <li class="active">
                <strong> Employee Lease Rider</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">

    </div>
</div>

<div class="RowsContatiner animated fadeInRight">
    <div class="col-lg-12">
        <div class="ibox float-e-margins">
            <div class="ibox-title" style="background:url('/img/hrbg-min.jpg');background-size: cover;padding: 240px 15px 7px;">

                <h1 style="color:black; text-transform:uppercase"> <b> Employee Lease Rider  </b></h1>

                @if (@Model.RoleType.ToLower() == "administrator" || @Model.RoleType.ToLower() == "hr")
                {

                    <div class="ibox-tools" style="margin-top:-55px;">
                        @*<a disabled="disabled" class="btnEdit" href="#" onclick="ToggleEdit('PropertyCard');"><i class="fa fa-edit"></i> Edit</a>

                    <a disabled="disabled" class="btnDelete" href="#">
                        <i class="fa fa-trash"></i> Delete
                    </a>*@

                        <a style="color:white;font-size: 30px;font-weight:bold" class="addnew" href="#" onclick="LoadHrForm('EmployeeLeaseRider'); LoadAllProperties();">
                            <i class="fa fa-plus-circle"></i> New
                        </a>
                    </div>
                }

            </div>

            <div class="modal fade bs-example-modal-lg reviewmodal" id="reviewmodal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                <div class="modal-dialog modal-lg" style="width:60%" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            @*<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>*@
                            <h1 class="modal-title" style="font-weight:bold;text-align: center;
    color: black;" id="gridSystemModalLabel">
                                Please verify employee email given below before submitting
                            </h1>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-12" style="text-align:center">

                                    <input type="email" style="width:50%;" id="eemail" />
                                    <br /> <br />
                                    <a class="btn btn-success nocorrect" id="nocorrect" href="#" onclick="hidepopupleaserider();" style="margin-left: 75px;
    margin-top: 10px;">
                                        No, I want to review
                                    </a>

                                    <a class="btn btn-danger yescorrect" id="yescorrect" href="#" onclick="showleaserider();" style="margin-left: 75px;
    margin-top: 10px;">  Yes,I want to submit
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


           @{ Html.RenderPartial("HrFormLogActivity"); }
            
            
            <div class="ibox-content" style="margin-left:0%; padding-top:20px;">
                <div id="status1"> </div>
                <div class="modal fade bs-example-modal-lg claimmodal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                    <div class="modal-dialog modal-lg" style="width:70%" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

                            </div>
                            <div class="modal-body">
                                <div class="row" style="padding: 20px;
    border: 2px solid black;text-align:center">
                                    <img src="~/img/carroll-print.png" />

                                    <h1 style="text-align: center;
    margin-top: 10px;">
                                        <strong><span style="font-size: 18.0pt; line-height: 115%;">EMPLOYEE LEASE RIDER</span></strong>
                                    </h1>
                                    @*<h1 style="text-align: center;
                                margin-top: -30px;">
                                                                    <strong><span style="font-size: 18.0pt; line-height: 115%;">EMPLOYEE LEASE RIDER</span></strong>
                                                                </h1>*@
                                    <form id="submitform" onsubmit="return false;">

                                        <p style="text-align: justify;"><span style="font-size: 10.0pt; line-height: 115%;"> Date :   </span>  <input type="date" id="leasedate" class="" /> </p>

                                        <p style="text-align: justify;"><span style="font-size: 10.0pt; line-height: 115%;">Name of Apartment Property :  </span> <select style=" display:inline; " id="location" class=""> </select> <input style=" display:inline;width:40%;display:none " type="text" id="apartmentname" class="" />  </p>

                                        <p style="text-align: justify;"><span style="font-size: 10.0pt; line-height: 115%;">I, <input style=" display:inline; width:35%; " onchange="document.getElementById('printempname').value = this.value;" type="text" id="empname" class="" />  , understand and agree to the following :  </span></p>

                                        <ol>
                                            <li style="text-align: justify;"><span style="font-size: 10.0pt; line-height: 115%;">All Carroll Organization employees have the option to reside at any participating Carroll Organization community. The current market rental value of the apartment is &nbsp; $ <input style=" display:inline; " type="text" id="marketvalue" class="allow_decimal" /> .&nbsp; The employee rental discount will be 20% off the market rental rate or the current net effective rent special.&nbsp; The monthly rent shall be &nbsp; $ <input style=" display:inline; " type="text" id="monthlyrent" class="allow_decimal" /> &nbsp; The employee rental rate shall be updated at renewal based on the market rent.</span></li>
                                            <li style="text-align: justify; "><span style="font-size: 10.0pt; line-height: 115%;">I understand that as an employee of the Carroll Organization, rent must be paid on the 1<sup>st</sup> of the month in full. I understand that any late rental payments or NSF&rsquo;s may result in termination of employment with the Carroll Organization. Continual late payments, NSF&rsquo;s or having a writ of possession filed are grounds for immediate termination.</span></li>
                                            <li style="text-align: justify; "><span style="font-size: 10.0pt; line-height: 115%;">If at any time during residency at <input style=" display:inline;width:33%; " type="text"  id="residency" class="" /> , the rental payment is received late or payment is returned NSF, all employee concessions (paragraph 1) will be void for that month and full market value and late fees will be due.</span></li>
                                            <li style="text-align: justify; "><span style="font-size: 10.0pt; line-height: 115%;">I understand that my residency at any Carroll Organization property is strictly voluntary and in no way a requirement of my employment with Carroll Organization.</span></li>
                                            <li style="text-align: justify; "><span style="font-size: 10.0pt; line-height: 115%;">Upon termination of my employment with Carroll Organization whether voluntary or involuntary, my lease will be terminated regardless of the lease term stated on the lease. I will not be considered a tenant of the apartment community nor will I have rights and privileges of a tenant without the written consent of the Carroll Organization.&nbsp; I further agree that upon such termination from employment, I will vacate the apartment occupied by me within <strong><u>seven days</u></strong> from the date of my termination of employment.</span></li>
                                            <li style="text-align: justify; "><span style="font-size: 10.0pt; line-height: 115%;">If the Carroll Organization should agree to allow me to continue to lease the apartment as a resident, a new lease will be signed that shall be at the current market rate and subject to all normal lease provisions.</span></li>
                                            <li style="text-align: justify; "><span style="font-size: 10.0pt; line-height: 115%;">Upon vacating the apartment occupied by me, for any reason, I will leave the apartment clean and in good condition.</span></li>
                                            <li style="text-align: justify; "><span style="font-size: 10.0pt; line-height: 115%;">I hereby authorize the Carroll Organization to deduct from my payroll check amounts due for unpaid rent, other amounts due to the Carroll Organization and any expenses incurred by the Carroll Organization to clean or repair the apartment in the event that I fail to leave it clean and in good condition.</span></li>
                                        </ol>

                                        <p style="text-align: justify;margin-top:30px;"> <span style="font-size: 10.0pt; line-height: 115%;"> Signature of Property Manager</span> <span style="font-size: 10.0pt; line-height: 115%;"> <input type="text" style="width:35%;" id="signatureproperymanager" /> </span>  <input type="date" style="float:right;margin-right: 15%;

width: 15%;" disabled id="pmdate" /> <span style="margin-right:20px;float:right;margin-top:10px;" id="pmdatespan"> Date : </span> </p>
                                        <p style="text-align: justify;">
                                            <span style="font-size: 10.0pt; line-height: 115%;"> Signature of Employee  : <input type="text" style="margin-left:45px;width:35%;" id="signature" disabled /> </span>  <input disabled style="float:right; margin-right:15%;width:15%;" type="date" id="positiondate" />  <span style="font-size: 10.0pt; line-height: 115%; float:right; margin-right:20px; margin-top:10px;"> Date : </span>
                                        </p>
                                        <p style="text-align: justify;"><span style="font-size: 10.0pt; line-height: 115%;"> Printed Name of Employee <input type="text" disabled style="margin-left:25px;width:35%;" id="printempname" /> </span></p>
                                        <p style="text-align: justify;"><span style="font-size: 10.0pt; line-height: 115%;">   Employee Email &nbsp;&nbsp;&nbsp;&nbsp; <input type="text" style="width:35%; margin-left:8%;" id="employeeemail" />  </span></p>

                                        <p style="text-align: justify; border: none; padding: 0cm;"><span style="font-size: 10.0pt; line-height: 115%;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The Carroll Organization Employee File</span></p>
                                        <br /> <br />
                                        <div id="status"> </div>
                                        <div class="col-md-12" style="text-align:center;margin-bottom:20px;">
                                            <input type="button" id="Submit" value="Submit" class="btn btn-primary" />  @*<button class="btn btn-success" disabled id="print"> <i class="fa-print fa"> </i> Print </button> <button disabled class="btn btn-success" id="pdf"> <i class="fa-file-pdf-o fa"> </i> Pdf </button>*@
                                        </div>
                                        <br /> <br />
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <table class="table  dtprops" width="100%"> </table>
            </div>
        </div>
    </div>

</div>

@if (ViewBag.ErrorMessage == "AuthorizationRequired")
{
    <p>You have to sign-in to see your to do list. Click @Html.ActionLink("here", "Index", "Form", new { reauth = true }, null) to sign-in.</p>

}
@if (ViewBag.ErrorMessage == "UnexpectedError")
{
    <p>An unexpected error occurred while retrieving your to do list.  Please try again.  You may need to sign-in.</p>
}
@section Styles {
    @Styles.Render("~/content/plugins/dataTables/dataTablesStylescss")
    @Styles.Render("~/content/plugins/token-inputcss")

    <style>

        .dtprops td, .dtprops th {
            white-space: nowrap;
        }

        input {
            border: none;
            border-bottom: 1px solid #0c0606;
            padding: 5px;
        }

        button {
            margin-left: 4%;
        }

        .has-error {
            border-color: red;
        }

        p {
            margin-bottom: 15px !important;
        }


        .modal {
            overflow-y: auto !important;
        }

        .modal-open {
            overflow: auto !important;
        }


    </style>
}

@section Scripts
{
    @Scripts.Render("~/scripts/plugins/dataTablesjs")
    @Scripts.Render("~/scripts/plugins/input-maskjs")
    @Scripts.Render("~/scripts/plugins/token-inputjs")

    <script>



        function hidepopupleaserider() {
            $('.reviewmodal').modal('hide');
            // $('#myModal').modal('show');
            LoadHrForm('EmployeeLeaseRider');
        }
       
        function showleaserider()
        {          
            $("#Submit").trigger('click');
            $isemailconfirmed = true;
        }


      

        
        $(".addnew").click(function () {
            $("#signature,#positiondate,#printempname").attr('disabled', true);
            document.getElementById("pmdate").valueAsDate = new Date();
            document.getElementById("leasedate").valueAsDate = new Date();
            $("#apartmentname").val('');
            $("#location").val('');
            $("#empname").val('');
            $("#marketvalue").val('');
            $("#monthlyrent").val('');
            $("#residency").val('');
            $("#signatureproperymanager").val('');
            $("#employeeemail").val('');
            $("#position").val('');

        });

        $(document).ready(function () {

            GetAllHRFORMs('LeaseRider');

            var leaseid = "";

            $("input").change(function (e) {
                e.preventDefault();

                if ($(this).val() == "") {
                    $(this).addClass("has-error");
                }
                else {
                    $(this).removeClass("has-error");
                }

            });

          

            document.getElementById("pmdate").valueAsDate = new Date();



            $(document).on('click', ".resendrpmmail,.resendempmail", function () {

                var action = $(this).attr('data-action');
                var refid = $(this).attr('data-ref');

                var insertForm = new FormData();
                insertForm.append('form', "LeaseRider");
                insertForm.append('action', action);
                insertForm.append('refid', refid);
                insertForm.append('CreatedBy', $("#CreatedBy").val());
                insertForm.append('CreatedByName', $("#CreatedByName").val());

                if ($("#divprocessingbtn").length > 0) {
                    $("#divprocessingbtn").show();
                }


                $.ajax({
                    url: $BaseApiUrl + "api/data/ResentHrWorkflow",
                    type: 'POST',
                    dataType: "JSON",
                    processData: false,
                    contentType: false,
                    data: insertForm,
                    success: function (data) {
                        // To-do code if ajax request is successful

                        if (data == true) {
                            GetAllHRFORMs('LeaseRider');
                            $(".alert").html('Email Resent Success');
                            if ($("#divprocessingbtn").length > 0) {
                                $("#divprocessingbtn").hide();
                            }
                            $('#toastnotification').modal('show');

                            setTimeout(function () {

                                $('#toastnotification').modal('hide');
                            }, 3000);
                        }
                        else {
                            $("#status").html(data);
                        }


                    },
                    error: function (ts) {
                        alert('error' + ts.exceptionMessage);
                    }
                });
            });

            $("#location").change(function () {

                $("#residency").val($("#location option:selected").text());


            });


            //$(".yescorrect").click(function ()
            //{
            //    $("#eemail").hide();
            //    $("#employeeemail").val($("#eemail").val());
            //    $("#Submit").click();
            //});

            $("#Submit").click(function (e)
            {
                e.preventDefault();

                var errormsgsummary = "";
                var control = "";
                $("#status").html('');

                $("input,select,textarea").removeClass('has-error');
                if ($("#leasedate").val() == "") {
                    errormsgsummary += "<li> Please Choose Date </li>";
                    $("#leasedate").addClass('has-error');
                    if (control == "")
                        control = $("#leasedate");
                }

                if ($("#location").val() == "") {
                    errormsgsummary += "<li> Please Enter Select Property </li>";
                    $("#location").addClass('has-error');
                    if (control == "")
                        control = $("#location");
                }

                if ($("#empname").val() == "") {
                    errormsgsummary += "<li> Please Enter Employee Name </li>";
                    $("#empname").addClass('has-error');
                    if (control == "")
                        control = $("#empname");
                }


                if ($("#marketvalue").val() == "") {
                    errormsgsummary += "<li> Please Enter Market Value of Property </li>";
                    $("#marketvalue").addClass('has-error');
                    if (control == "")
                        control = $("#marketvalue");
                }


                if ($("#monthlyrent").val() == "") {
                    errormsgsummary += "<li> Please Enter Monthly Rent </li>";
                    $("#monthlyrent").addClass('has-error');
                    if (control == "")
                        control = $("#monthlyrent");
                }


                if ($("#residency").val() == "")
                {
                    errormsgsummary += "<li> Please Enter Residency Place  </li>";
                    $("#residency").addClass('has-error');
                    if (control == "")
                        control = $("#residency");
                }

                if ($("#employeeemail").val() == "")
                {
                    errormsgsummary += "<li> Please Enter Employee Email  </li>";
                    $("#employeeemail").addClass('has-error');
                    if (control == "")
                        control = $("#employeeemail");
                }

                if ($("#signatureproperymanager").val() == "") {
                    errormsgsummary += "<li> Please Enter PM Signature  </li>";
                    $("#signatureproperymanager").addClass('has-error');
                    if (control == "")
                        control = $("#signatureproperymanager");
                }

                if (errormsgsummary != "") {

                    $("#status").html('<ul style="float: left;text-align:left;color: red;"> ' + errormsgsummary + ' </ul> ');

                    setTimeout(ScrollToElement(control), 3000);
                    $("#Submit").prop('disabled', false);
                    return false;
                }
                else
                {

                    if ($isemailconfirmed)
                    {

                        $('#myModal').modal('hide');
                        $('.reviewmodal').modal('hide');

                        $("#Submit").prop('disabled', false);
                        //$("#status1").html("<p style='color:green;font-weight:bold;'> Processing ........ </p>");
                        $(".alert").html('Processing');
                        $('#toastnotification').modal('show');

                        $("input").prop('disabled', false);

                        var insertForm = new FormData();
                        insertForm.append('date', $("#leasedate").val());
                        insertForm.append('community', $("#location option:selected").text());
                        insertForm.append('empname', $("#empname").val());
                        insertForm.append('marketvalue', $("#marketvalue").val());
                        insertForm.append('emprent', $("#monthlyrent").val());
                        insertForm.append('residence', $("#residency").val());
                      //  insertForm.append('position', $("#position").val());
                        insertForm.append('empemail', $("#employeeemail").val());
                        insertForm.append('signature', $("#signature").val());
                        insertForm.append('pmdate', $("#pmdate").val());
                        insertForm.append('positiondate', $("#positiondate").val());
                        insertForm.append('propertymanager', $("#signatureproperymanager").val());
                        insertForm.append('CreatedBy', $("#CreatedBy").val());
                        insertForm.append('CreatedByName', $("#CreatedByName").val());

                        $.ajax({
                            url: $BaseApiUrl + "api/data/InsertEmployeeLeaseRider",
                            type: 'POST',
                            dataType: "JSON",
                            processData: false,
                            contentType: false,
                            data: insertForm,
                            success: function (data)
                            {
                                // To-do code if ajax request is successful

                                if (data['error'] == false) {

                                    leaseid = data['insertedId'];


                                    var insertForm = new FormData();
                                    insertForm.append('refid', leaseid);
                                    insertForm.append('form', "EmployeeLeaseRider");


                                    //$.ajax({
                                    //    url: "/Hr/SendHrFormCompletionNotification/",
                                    //    type: 'POST',
                                    //    dataType: "JSON",
                                    //    processData: false,
                                    //    contentType: false,
                                    //    data: insertForm,
                                    //    success: function (data) {
                                    //        // To-do code if ajax request is successful

                                    //    },
                                    //    error: function (ts) {
                                    //        //  alert('error' + ts.exceptionMessage);
                                    //    }
                                    //});

                                    $("#status1").html('');
                                    GetAllHRFORMs('LeaseRider');
                                    $("#submitform").trigger('reset');

                                    $("#leasedate").val('');
                                    $("#apartmentname").val('');
                                    $("#empname").val('');
                                    $("#marketvalue").val('');
                                    $("#monthlyrent").val('');
                                    $("#residency").val('');
                                    ShowToastNotification('Record Successfully Updated', 3);

                                    setTimeout(function () {

                                        $("#print").attr('disabled', false);
                                        $("#pdf").attr('disabled', false);
                                        $("#Submit").attr('disabled', false);
                                        $("#status1").html('');
                                        $('#toastnotification').modal('hide');
                                    }, 3000);
                                }
                                else {
                                    $('#myModal').modal('show');
                                    $("#status").html(data['errorMsg']);
                                }

                            },
                            error: function (ts) {
                                alert('error' + ts.exceptionMessage);
                            }
                        });
                    }
                    else
                    {                       
                        $('#myModal').modal('hide');
                        $('.reviewmodal').modal('show');
                        $("#eemail").show();
                        $("#eemail").val($("#employeeemail").val());
                    }

                    

                }


            });

          
        });

    </script>

}
